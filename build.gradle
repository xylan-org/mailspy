plugins {
    alias libs.plugins.owasp.dependencycheck
}

description = "MailSpy :: Root"

wrapper {
    gradleVersion = libs.versions.gradle.get()
}

allprojects {
    group = "org.xylan.mailspy"
    version = "1.0.0-SNAPSHOT"

    repositories {
        mavenCentral()
    }
}

subprojects {
    if (file("$projectDir/src/main/java").exists()) {
        apply plugin: "checkstyle"
        checkstyle {
            configFile file("$rootDir/config/checkstyle.xml")
            toolVersion = libs.versions.checkstyle.get()
        }

        apply plugin: "pmd"
        pmd {
            ruleSets = []
            ruleSetFiles = files("$rootDir/config/pmd.xml")
            toolVersion = libs.versions.pmd.get()
            consoleOutput = true
        }
    }
    tasks.withType(JavaCompile) {
        options.release = 11
    }
}

dependencyCheck {
    suppressionFile "$rootDir/config/owasp-suppressions.xml"
    scanConfigurations = ["runtimeClasspath", "compileClasspath"]
    analyzers {
        nodeEnabled = false // cannot skip dev deps, see https://github.com/jeremylong/DependencyCheck/issues/2482#issuecomment-603755623
        assemblyEnabled = false
        nodeAudit {
            skipDevDependencies = true
        }
        retirejs {
            enabled = false
        }
    }
}
